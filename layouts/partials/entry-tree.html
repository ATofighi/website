
{{ $entries := .entries }}
{{ $currentPage := .currentPage }}

<aside class="menu">
  {{ range $entries }}
    {{ if .HasChildren }}
      <p class="menu-label">
        <a {{ if (or ($currentPage.IsMenuCurrent .Menu .) ($currentPage.HasMenuCurrent .Menu .)) }}class="is-active"{{ end }} href="{{ .URL }}">
          {{ .Name }}
        </a>
      </p>
      <ul class="menu-list">
        {{ $parent := . }}
        {{ range .Children }}
          {{ if .HasChildren }}
            <li>
              <a 
                {{ if (or ($currentPage.IsMenuCurrent .Menu .) ($currentPage.HasMenuCurrent .Menu .)) }}class="is-active"{{ end }}
                href="{{ .URL }}">
                {{ .Name }}
              </a>
              <ul>
                {{ $parent = . }}
                {{ range .Children }}
                  <li>
                    <a 
                      {{ if $currentPage.IsMenuCurrent .Menu . }}class="is-active"{{ end }}
                      href="{{ .URL }}">
                      {{ .Name }}
                    </a> 
                  </li>
                {{ end }}
              </ul>
            </li>
          {{ else }}
            <li>
              <a
                {{ if (or ($currentPage.IsMenuCurrent .Menu .) ($currentPage.HasMenuCurrent .Menu .)) }}class="is-active"{{ end }}
                href="{{ .URL }}">
                {{ .Name }}
              </a>
            </li>
          {{ end }}
        {{ end }}
      </ul>
    {{ else }}
      <p class="menu-label">
        <a 
          {{ if $currentPage.IsMenuCurrent .Menu . }}class="is-active"{{ end }}
          href="{{ .URL }}">
          <span>{{ .Name }}</span>
        </a>
      </p>
    {{ end }}
  {{ end }}
</aside>